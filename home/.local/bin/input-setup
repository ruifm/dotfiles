#!/usr/bin/env sh

[ -r ~/.config/X11/Xkeymap ] && xkbcomp ~/.config/X11/Xkeymap "$DISPLAY"
if [ "$(hostname)" = "halley" ]; then
    setxkbmap -layout no
else
    setxkbmap -layout es
    xmodmap ~/.config/X11/Xmodmap
fi
setxkbmap -option "caps:escape"
xset r rate 250 30

setlayout() {
    ids=$(xinput --list | sed -ne '/Virtual core keyboard/{:a' -e 'n;p;ba' -e '}' | grep "$1" | sed -n 's/.*id=\([0-9]\+\).*/\1/p')
    for i in $ids
    do
        setxkbmap -device "$i" -layout "$2"
    done
 }

setlayout "Kingston HyperX Alloy FPS Pro Mechanical Gaming Keyboard" us
setlayout "SONiX USB DEVICE" us

if [ "$(hostname)" = "garry" ]; then
    xinput set-prop "ETPS/2 Elantech Touchpad" "libinput Tapping Enabled" 1
    xinput set-prop "ETPS/2 Elantech Touchpad" "libinput Natural Scrolling Enabled" 1
    ids=$(xinput --list | sed -ne '/Virtual core pointer/{:a' -e 'n;p;ba' -e '}' | grep "Kingsis Peripherals ZOWIE Gaming mouse" | sed -n 's/.*id=\([0-9]\+\).*/\1/p')
    for i in $ids
    do
        xinput --set-prop "$i" 'libinput Accel Profile Enabled' 0, 1
    done
elif [ "$(hostname)" = "hercules" ]; then
    xinput set-prop "ETPS/2 Elantech Touchpad" "libinput Tapping Enabled" 1
    xinput set-prop "ETPS/2 Elantech Touchpad" "libinput Natural Scrolling Enabled" 1
elif [ "$(hostname)" = "halley" ]; then
    xinput set-prop "SynPS/2 Synaptics TouchPad" "libinput Tapping Enabled" 1
    xinput set-prop "SynPS/2 Synaptics TouchPad" "libinput Natural Scrolling Enabled" 1
    xinput set-prop "ELAN Touchscreen" "Device Enabled" 0
fi
