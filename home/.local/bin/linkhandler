#!/usr/bin/env sh

# If no url given. Opens browser. For using script as $BROWSER.
if [ -z "$1" ]; then
    url=$(xclip -o -selection clipboard)
else
    url="$1"
fi

case "$url" in
	*mkv|*webm|*mp4|*mp3|*ogg|*youtube.com/watch*|*youtube.com/playlist*|*youtu.be*|*twitch.tv*)
		setsid mpv -quiet "$url" >/dev/null 2>&1 & ;;
	*lbry*)
        lbry_url=$(curl "$url" | grep embed | sed 's/.*embed\(.*\)">.*/\1/' | cut -d '"' -f1 | awk -v prefix="https://cdn.lbryplayer.xyz/api/v2/streams/free" '{print prefix $0}')
		setsid mpv -quiet "$lbry_url" >/dev/null 2>&1 & ;;
	*png|*jpg|*jpe|*jpeg|*gif)
		curl -sL "$url" > "/tmp/$(echo "$url" | sed "s/.*\///")" && setsid sxiv -a "/tmp/$(echo "$url" | sed "s/.*\///")"  >/dev/null 2>&1 & ;;
	*pdf|*ps|*epub)
		curl -sL "$url" > "/tmp/$(echo "$url" | sed "s/.*\///")" && setsid zathura "/tmp/$(echo "$url" | sed "s/.*\///")"  >/dev/null 2>&1 & ;;
	*torrent)
		curl -sL "$url" > "/tmp/$(echo "$url" | sed "s/.*\///")" && setsid toradd "/tmp/$(echo "$url" | sed "s/.*\///")"  >/dev/null 2>&1 & ;;
	magnet*)
		setsid toradd "$url" >/dev/null 2>&1 & ;;
	acestream*)
		setsid acestream-launcher "$url" >/dev/null 2>&1 & ;;
	*rss|*xml)
		setsid rssadd "$url" >/dev/null 2>&1 & ;;
	mailto*)
		setsid neomutt "$url" >/dev/null 2>&1 & ;;
	*.dot)
		setsid xdot "$url" >/dev/null 2>&1 & ;;
	*)
		if [ -f "$url" ]; then
            "$EDITOR $1"
        elif pgrep firefox >/dev/null 2>&1; then
            firefox "$url" >/dev/null 2>&1 &
        else
            w3m "$url"
        fi ;;
esac
